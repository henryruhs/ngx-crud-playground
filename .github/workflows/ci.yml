name: ci

on: [ push, pull_request ]

jobs:
 lint:
  runs-on: ubuntu-latest
  steps:
  - name: Checkout
    uses: actions/checkout@v2
  - name: Set up Node 14
    uses: actions/setup-node@v1
    with:
     node-version: 14
  - run: npm install
  - run: npm run lint
 build:
  runs-on: ubuntu-latest
  steps:
  - name: Checkout
    uses: actions/checkout@v2
  - name: Set up Node 14
    uses: actions/setup-node@v1
    with:
     node-version: 14
  - run: npm install
  - run: npm run build
  - name: Upload artifact
    uses: actions/upload-artifact@v2
    with:
     name: dist
     path: dist
 test-unit:
  runs-on: ubuntu-latest
  steps:
  - name: Checkout
    uses: actions/checkout@v2
  - name: Set up Node 14
    uses: actions/setup-node@v1
    with:
     node-version: 14
  - run: npm install
  - run: npm run test
 test-acceptance:
  runs-on: ubuntu-latest
  steps:
  - name: Checkout
    uses: actions/checkout@v2
  - name: Set up Node 14
    uses: actions/setup-node@v1
    with:
     node-version: 14
  - run: npm install
  - run: npm run e2e
 deploy:
  needs: [ build, test-unit, test-acceptance ]
  if: github.ref == 'refs/heads/master'
  runs-on: ubuntu-latest
  steps:
  - name: Checkout
    uses: actions/checkout@v2
  - name: Download artifact
    uses: actions/download-artifact@v2
    with:
     name: dist
     path: dist
  - name: Deploy to Vercel
    uses: amondnet/vercel-action@v20
    with:
     vercel-token: ${{ secrets.VERCEL_TOKEN }}
     vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
     vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
     vercel-args: --confirm --prod
